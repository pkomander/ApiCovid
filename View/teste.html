<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="./assets/jquery-1.8.2.js"></script>
    <title>Document</title>
</head>
<body>
    <div class=".container">
    
        <div class="containerBusca">
            <div>
                <h2 class="titulo">buscar data:</h2>
                <input type="date" name="dataInicial" id="data" >
                <select id="selectOptionData">
                    <option></option>
                    <option value="Casos por data">Casos por data</option>
                    <option value="Total de casos">Total de casos</option>
                </select>
                <button type="button" class="btn btn-primary" onclick="PegaData()">Buscar</button>
            </div>
            
            <div>
                <h2 class="titulo">listar datas disponiveis:</h2>
                <select id="selectOption" onChange="pegaSelect()">
                    <option></option>
                    <option value="Listar datas">Listar datas</option>
                </select>
            </div>
        </div>

        <div class="tabelas">
            <div class="table-wrapper-scroll-y my-custom-scrollbar" id="divTabela">
                <table class="table table-earnings table-earnings__challenge">
                    <thead id="thead">
                    <!-- <tr>
                        <th scope="col">Variant</th>
                        <th scope="col">Date</th>
                        <th scope="col">Location</th>
                        <th scope="col-md-4">Total de Casos</th>
                    </tr> -->
                    </thead>
                    <tbody id="tbody">
                    
                    </tbody>
                </table>
            </div>

            <div id="divTabela2">
                <table class="table table-earnings table-earnings__challenge">
                    <thead>
                    <tr>
                        <th scope="col">Date</th>
                    </tr>
                    </thead>
                    <tbody id="tbody2">
                    
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <style>
        .containerBusca{
            display: flex;
            justify-content: space-evenly;
            padding-bottom: 10px;
        }

        .tabelas{
            display: flex;
            justify-content: space-around;
        }

        body{
            background-color: #312d44;
        }

        .titulo{
            color: white;
        }

        .table-earnings {
            background: #F3F5F6;
        }

        table{
            color: black;
            background-color: white;
            display: block;
            height: 14%;
            overflow-y: auto;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
        
        function pegaSelect(){
            var select = document.querySelector("#selectOption");
            var option = select.options[select.selectedIndex];
            console.log(option.value);
            BuscaInfoCovid(option.value);
        }

        function PegaData(){
            var data = document.querySelector("#data").value;
            console.log(data);
            var selectData = document.querySelector("#selectOptionData");
            var option = selectData.options[selectData.selectedIndex];
            console.log(option.value);

            if(option.value == "Total de casos"){
                InfoCovid(data);
            }
            else if(option.value == "Casos por data"){
                InfoCovidData(data)
            }
        }
    
        function InfoCovid(date){
            //url testeCoodesh = http://localhost:5000/CasoCovid/cases/2020-07-06/cumulative
            //url teste = 'https://localhost:5001/CasoCovid/daterangeTotal/'+date+''
            $.ajax({
                dataType: "json",
                type: "GET",
                url: 'https://localhost:5001/CasoCovid/cases/'+date+'/cumulative',
                success: function (dados) {
                    let thead = document.querySelector("#thead");
                    thead.innerHTML = `
                    <tr>
                        <th scope="col">Variant</th>
                        <th scope="col">Date</th>
                        <th scope="col">Location</th>
                        <th scope="col-md-4">Total de Casos</th>
                    </tr>
                    `;
                    let tbody = document.querySelector("#tbody");
                    tbody.innerHTML = "";
                    console.log(dados);
                    $(dados).each(function (i) {
                        tbody.innerHTML += `
                        <tr>
                            <th>`+dados[i].variant+`</th>    
                            <th>`+dados[i].date+`</th>
                            <th>`+dados[i].location+`</th>    
                            <th>`+dados[i].totalCasos+`</th>    
                        </tr>
                        `
                        // document.writeln("<p>Nome: " + dados[i].variant + " | URL: " + dados[i].totalCasos + "</p>")
                    });
                }
            }); 
        }



        function InfoCovidData(date){
            //url testeCoodesh = http://localhost:5000/CasoCovid/cases/2020-07-06/count
            //url teste = 'https://localhost:5001/CasoCovid/daterange/'+date+''
            $.ajax({
                dataType: "json",
                type: "GET",
                url: 'https://localhost:5001/CasoCovid/cases/'+date+'/count',
                success: function (dados) {
                    let thead = document.querySelector("#thead");
                    thead.innerHTML = `
                    <tr>
                        <th scope="col">Location</th>
                        <th scope="col">Date</th>
                        <th scope="col">Variant</th>
                        <th scope="col">Num_Sequences</th>
                        <th scope="col">Perc_Sequences</th>
                        <th scope="col">Num_Sequences_Total</th>
                    </tr>
                    `;
                    let tbody = document.querySelector("#tbody");
                    tbody.innerHTML = "";
                    console.log(dados);
                    $(dados).each(function (i) {
                        tbody.innerHTML += `
                        <tr>
                            <th>`+dados[i].location+`</th>    
                            <th>`+dados[i].date+`</th>
                            <th>`+dados[i].variant+`</th>    
                            <th>`+dados[i].num_Sequences+`</th> 
                            <th>`+dados[i].perc_Sequences+`</th>
                            <th>`+dados[i].num_Sequesces_total+`</th>
                        </tr>
                        `
                        // document.writeln("<p>Nome: " + dados[i].variant + " | URL: " + dados[i].totalCasos + "</p>")
                    });
                }
            }); 
        }




        function BuscaInfoCovid(option){
            if(option == "Listar datas"){
                    $.ajax({
                    dataType: "json",
                    type: "GET",
                    url: 'http://localhost:5000/CasoCovid/dates/',
                    success: function (dados) {
                        console.log(dados);
                        $(dados).each(function (i) {
                            let tbody = document.querySelector("#tbody2");
                            tbody.innerHTML += `
                            <tr>
                                <th>`+dados[i]+`</th>   
                            </tr>
                            `
                            // document.writeln("<p>Nome: " + dados[i].variant + " | URL: " + dados[i].totalCasos + "</p>")
                        });
                    }
                }); 
            }
            
        }
        
    </script>
    
</body>
</html>